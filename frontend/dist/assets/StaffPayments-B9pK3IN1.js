import{j as h,_ as I,e as R,o as s,c as u,a as e,n as b,t as n,d as p,F as w,f as x,r as g,g as z,h as C}from"./index-DDxpmVXJ.js";const f={getEligible:()=>h.get("/payments/eligible"),generateBatch:v=>h.post("/payments/batch",{application_ids:v}),getBatches:(v={})=>h.get("/payments/batches",{params:v}),getBatchDetails:v=>h.get(`/payments/batches/${v}`),confirmBatch:v=>h.post(`/payments/batches/${v}/confirm`),getDuplicates:()=>h.get("/payments/duplicates")},j={class:"staff-payments"},O={class:"tabs"},V={key:0,type:"emergency",heading:"Error"},M={key:1,type:"success",heading:"Success"},q={key:2,class:"loading"},H={key:3},J={class:"action-bar"},K=["disabled"],Q={key:0,class:"empty-state"},W={key:1,class:"data-table"},X=["checked"],Y=["disabled","checked","onChange"],Z={class:"amount"},ee={key:0,class:"badge badge-ok"},te={key:1,class:"badge badge-warn"},le={class:"amount total-amount"},ae={key:4},ne={key:0,class:"empty-state"},se={key:1,class:"data-table"},ue={class:"amount"},oe=["on_click"],ie=["on_click"],ce={key:5},re={key:0,class:"empty-state"},de={key:1,class:"data-table"},ge={__name:"StaffPayments",setup(v){const d=g("eligible"),r=g(!0),i=g(null),m=g(null),_=g(!1),y=g([]),o=g([]),k=g([]),B=g([]),S=z(()=>y.value.filter(a=>o.value.includes(a.id)).reduce((a,t)=>a+t.amount,0));R(()=>$());async function $(){var a,t;r.value=!0,i.value=null;try{y.value=await f.getEligible(),o.value=[]}catch(l){i.value=((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.message)||l.message||"Failed to load eligible applications"}finally{r.value=!1}}async function F(){var a,t;r.value=!0,i.value=null;try{const l=await f.getBatches();k.value=l.data||[]}catch(l){i.value=((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.message)||l.message||"Failed to load batches"}finally{r.value=!1}}async function N(){var a,t;r.value=!0,i.value=null;try{B.value=await f.getDuplicates()}catch(l){i.value=((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.message)||l.message||"Failed to check duplicates"}finally{r.value=!1}}function T(a){a.target.checked?o.value=y.value.filter(t=>t.has_banking).map(t=>t.id):o.value=[]}function E(a){const t=o.value.indexOf(a);t>=0?o.value.splice(t,1):o.value.push(a)}async function L(){var a,t;if(o.value.length!==0){_.value=!0,i.value=null,m.value=null;try{const l=await f.generateBatch(o.value);if(m.value=`Payment batch ${l.batch_number} generated: ${l.application_count} applications, $${l.total_amount.toFixed(2)} total`,l.file_content){const c=new Blob([l.file_content],{type:"text/plain"}),A=URL.createObjectURL(c),D=document.createElement("a");D.href=A,D.download=l.file_name,D.click(),URL.revokeObjectURL(A)}await $()}catch(l){i.value=((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.message)||l.message||"Failed to generate batch"}finally{_.value=!1}}}async function U(a){var t,l;i.value=null;try{const c=await f.confirmBatch(a);m.value=`Batch confirmed as paid: ${c.count} applications`,setTimeout(()=>m.value=null,5e3),F()}catch(c){i.value=((l=(t=c.response)==null?void 0:t.data)==null?void 0:l.message)||c.message||"Failed to confirm payment"}}function G(a){m.value=`Batch file: ${a.file_name}`,setTimeout(()=>m.value=null,3e3)}function P(a){return a?new Date(a).toLocaleDateString("en-CA",{year:"numeric",month:"short",day:"numeric"}):"-"}return(a,t)=>(s(),u("div",j,[t[19]||(t[19]=e("h1",null,"Payment Processing",-1)),t[20]||(t[20]=e("p",{class:"subtitle"},"Generate payment batches for approved scholarship applications",-1)),e("div",O,[e("button",{class:b({active:d.value==="eligible"}),onClick:t[0]||(t[0]=l=>{d.value="eligible",$()})}," Eligible for Payment ",2),e("button",{class:b({active:d.value==="batches"}),onClick:t[1]||(t[1]=l=>{d.value="batches",F()})}," Payment Batches ",2),e("button",{class:b({active:d.value==="duplicates"}),onClick:t[2]||(t[2]=l=>{d.value="duplicates",N()})}," Duplicate Detection ",2)]),i.value?(s(),u("goa-callout",V,n(i.value),1)):p("",!0),m.value?(s(),u("goa-callout",M,n(m.value),1)):p("",!0),r.value?(s(),u("div",q,[...t[3]||(t[3]=[e("goa-circular-progress",{size:"large"},null,-1)])])):p("",!0),!r.value&&d.value==="eligible"?(s(),u("div",H,[e("div",J,[e("span",null,n(o.value.length)+" of "+n(y.value.length)+" selected",1),e("goa-button",{type:"primary",on_click:L,disabled:o.value.length===0||_.value},n(_.value?"Generating...":"Generate Payment Batch"),41,K)]),y.value.length===0?(s(),u("div",Q,[...t[4]||(t[4]=[e("p",null,"No approved applications with direct deposit setup.",-1)])])):(s(),u("table",W,[e("thead",null,[e("tr",null,[e("th",null,[e("input",{type:"checkbox",onChange:T,checked:o.value.length===y.value.filter(l=>l.has_banking).length},null,40,X)]),t[5]||(t[5]=e("th",null,"Reference #",-1)),t[6]||(t[6]=e("th",null,"Applicant",-1)),t[7]||(t[7]=e("th",null,"Scholarship",-1)),t[8]||(t[8]=e("th",null,"Amount",-1)),t[9]||(t[9]=e("th",null,"Bank Info",-1)),t[10]||(t[10]=e("th",null,"Account",-1))])]),e("tbody",null,[(s(!0),u(w,null,x(y.value,l=>(s(),u("tr",{key:l.id,class:b({"no-banking":!l.has_banking})},[e("td",null,[e("input",{type:"checkbox",disabled:!l.has_banking,checked:o.value.includes(l.id),onChange:c=>E(l.id)},null,40,Y)]),e("td",null,n(l.reference_number),1),e("td",null,n(l.display_name),1),e("td",null,n(l.scholarship_name),1),e("td",Z,"$"+n(l.amount.toFixed(2)),1),e("td",null,[l.has_banking?(s(),u("span",ee,"DD Setup")):(s(),u("span",te,"No DD"))]),e("td",null,n(l.has_banking?`${l.institution_number}-${l.transit_number} ${l.account_masked}`:"-"),1)],2))),128))]),e("tfoot",null,[e("tr",null,[t[11]||(t[11]=e("td",{colspan:"4",class:"total-label"},"Selected Total:",-1)),e("td",le,"$"+n(S.value.toFixed(2)),1),t[12]||(t[12]=e("td",{colspan:"2"},null,-1))])])]))])):p("",!0),!r.value&&d.value==="batches"?(s(),u("div",ae,[k.value.length===0?(s(),u("div",ne,[...t[13]||(t[13]=[e("p",null,"No payment batches generated yet.",-1)])])):(s(),u("table",se,[t[14]||(t[14]=e("thead",null,[e("tr",null,[e("th",null,"Batch #"),e("th",null,"Generated By"),e("th",null,"Applications"),e("th",null,"Total Amount"),e("th",null,"Status"),e("th",null,"Date"),e("th",null,"Actions")])],-1)),e("tbody",null,[(s(!0),u(w,null,x(k.value,l=>(s(),u("tr",{key:l.id},[e("td",null,n(l.batch_number),1),e("td",null,n(l.generated_by_name),1),e("td",null,n(l.application_count),1),e("td",ue,"$"+n(parseFloat(l.total_amount).toFixed(2)),1),e("td",null,[e("span",{class:b(["badge",l.status==="Paid"?"badge-ok":"badge-pending"])},n(l.status),3)]),e("td",null,n(P(l.created_at)),1),e("td",null,[l.status==="Generated"?(s(),u("goa-button",{key:0,type:"tertiary",size:"compact",on_click:c=>U(l.id)}," Confirm Paid ",40,oe)):p("",!0),e("goa-button",{type:"tertiary",size:"compact",on_click:c=>G(l)}," Download ",40,ie)])]))),128))])]))])):p("",!0),!r.value&&d.value==="duplicates"?(s(),u("div",ce,[B.value.length===0?(s(),u("div",re,[...t[15]||(t[15]=[e("goa-callout",{type:"success",heading:"No Duplicates"}," No duplicate bank accounts detected. ",-1)])])):(s(),u("table",de,[t[18]||(t[18]=e("thead",null,[e("tr",null,[e("th",null,"User 1"),e("th",null,"User 2"),e("th",null,"Institution #"),e("th",null,"Transit #"),e("th",null,"Account"),e("th",null,"Flagged")])],-1)),e("tbody",null,[(s(!0),u(w,null,x(B.value,(l,c)=>(s(),u("tr",{key:c,class:"duplicate-row"},[e("td",null,[C(n(l.user1_name),1),t[16]||(t[16]=e("br",null,null,-1)),e("small",null,n(l.user1_email),1)]),e("td",null,[C(n(l.user2_name),1),t[17]||(t[17]=e("br",null,null,-1)),e("small",null,n(l.user2_email),1)]),e("td",null,n(l.institution_number),1),e("td",null,n(l.transit_number),1),e("td",null,n(l.account_masked),1),e("td",null,n(P(l.user2_created)),1)]))),128))])]))])):p("",!0)]))}},me=I(ge,[["__scopeId","data-v-20e5a844"]]);export{me as default};
//# sourceMappingURL=StaffPayments-B9pK3IN1.js.map
