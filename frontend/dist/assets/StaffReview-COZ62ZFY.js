import{_ as Ne,e as xe,o as n,c as a,a as e,t as i,h as u,n as b,d as c,F as A,f as C,w as x,i as Me,r,g as qe,u as De}from"./index-DDxpmVXJ.js";import{s as p}from"./staffService-ohwfNNCE.js";import{c as ue}from"./corService-Dge5eI5Q.js";const Se={class:"staff-review"},Ie={key:0,class:"loading"},$e={key:1,class:"error-state"},je={type:"emergency",heading:"Application not found"},ze={key:2},Ee={class:"page-header"},Fe=["type","heading"],Oe={class:"review-layout"},Be={class:"review-main"},Le={class:"detail-section"},Pe={class:"detail-grid"},Te={class:"full-width"},Ve={class:"detail-section"},Ye={class:"eligibility-grid"},Ge={class:"elig-icon"},He={class:"elig-icon"},Qe={class:"elig-icon"},Ue={class:"elig-icon"},Ke={class:"detail-section"},Je={class:"detail-grid"},We={key:0,class:"sub-section"},Xe={class:"detail-grid"},Ze={key:0,class:"detail-section"},et={class:"essay-box"},tt={key:1,class:"detail-section"},st={key:0},ot={class:"text-box"},lt={key:1},it={class:"text-box"},nt={class:"detail-section"},at={key:0,class:"doc-list"},ut={class:"doc-meta"},rt={key:1,class:"no-data"},dt={key:2,class:"detail-section"},ct={class:"history-list"},vt={class:"history-date"},gt={class:"review-sidebar"},mt={class:"action-panel"},pt={class:"action-group"},_t=["value"],ft=["value","label"],yt={class:"action-group"},ht=["value"],bt=["disabled"],kt={key:0,class:"existing-notes"},wt={class:"notes-box"},Rt={class:"action-group cor-section"},At={class:"cor-status-display"},Ct={key:0,class:"cor-actions"},Nt=["disabled"],xt={key:1,class:"cor-actions"},Mt={key:1,class:"decision-actions"},qt={key:2,class:"decision-result"},Dt={class:"dialog"},St={label:"Notes (optional)"},It=["value"],$t={class:"dialog-actions"},jt=["disabled"],zt={class:"dialog"},Et={label:"Rejection Reasons",requirement:"required"},Ft={class:"reason-list"},Ot=["name","text","checked","on_change"],Bt={label:"Additional Notes"},Lt=["value"],Pt={class:"dialog-actions"},Tt=["disabled"],Vt={class:"dialog"},Yt={label:"Missing Items",requirement:"required"},Gt={class:"reason-list"},Ht=["name","text","checked","on_change"],Qt={label:"Custom Message"},Ut=["value"],Kt={class:"dialog-actions"},Jt=["disabled"],Wt={class:"dialog"},Xt={label:"Institution Email"},Zt=["value"],es={label:"Custom Message (optional)"},ts=["value"],ss={class:"dialog-actions"},os=["disabled"],ls={__name:"StaffReview",setup(is){const re=Me();De();const j=r(!0),g=r(!1),s=r(null),z=r([]),_=r(""),N=r(""),E=r("success"),k=r(!1),w=r(!1),R=r(!1),M=r(""),q=r(""),f=r([]),D=r(""),y=r([]),de=["Does not meet citizenship requirements","Does not meet residency requirements","Not enrolled in eligible institution","Incomplete application","Missing required documents","Does not meet academic requirements"],h=r(!1),m=r(!1),S=r(""),I=r(""),ce=["Missing transcripts","Enrollment not confirmed","Residency documents needed","Identification documents needed","Incomplete personal information","Missing reference letter"],ve=qe(()=>s.value&&["Submitted","Under Review"].includes(s.value.status));xe(async()=>{try{const[l,t]=await Promise.all([p.getApplication(re.params.id),p.getMembers()]);s.value=l,z.value=t}catch(l){console.error("Failed to load:",l)}finally{j.value=!1}});function ge(l){return l&&[l.address_street,l.address_city,l.address_province,l.address_postal_code].filter(Boolean).join(", ")||"N/A"}function me(l){return l?new Date(l).toLocaleDateString("en-CA",{year:"numeric",month:"short",day:"numeric"}):""}function pe(l){return l?new Date(l).toLocaleString("en-CA",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function _e(l){return l?l<1024?l+" B":l<1048576?(l/1024).toFixed(1)+" KB":(l/1048576).toFixed(1)+" MB":""}async function fe(l){try{await p.assign(s.value.id,l.detail.value||null),s.value.reviewer_id=l.detail.value,v("Application assigned successfully","success")}catch(t){v("Failed to assign: "+t.message,"emergency")}}async function ye(){if(_.value.trim())try{const l=await p.addNotes(s.value.id,_.value.trim());s.value.review_notes=l.review_notes,_.value="",v("Note added","success")}catch{v("Failed to add note","emergency")}}async function he(){g.value=!0;try{await p.approve(s.value.id,{notes:M.value}),s.value.status="Approved",s.value.decision="Approved",k.value=!1,v("Application approved successfully","success")}catch(l){v("Failed to approve: "+l.message,"emergency")}finally{g.value=!1}}async function be(){g.value=!0;try{await p.reject(s.value.id,{reasons:f.value,notes:q.value}),s.value.status="Rejected",s.value.decision="Rejected",w.value=!1,v("Application rejected","success")}catch(l){v("Failed to reject: "+l.message,"emergency")}finally{g.value=!1}}async function ke(){g.value=!0;try{await p.sendMILetter(s.value.id,{reasons:y.value,custom_message:D.value}),s.value.status="Missing Info",R.value=!1,v("Missing information request sent","success")}catch(l){v("Failed to send MI request: "+l.message,"emergency")}finally{g.value=!1}}function we(l,t){t?f.value.push(l):f.value=f.value.filter(d=>d!==l)}function Re(l,t){t?y.value.push(l):y.value=y.value.filter(d=>d!==l)}async function Ae(){var l,t;m.value=!0;try{const d=await ue.checkCOR(s.value.id);s.value.cor_status=d.status,v(`COR check: ${d.message}`,"success")}catch(d){v("COR check failed: "+(((t=(l=d.response)==null?void 0:l.data)==null?void 0:t.message)||d.message),"emergency")}finally{m.value=!1}}async function Ce(){var l,t;m.value=!0;try{const d=await ue.sendRequest(s.value.id,{institution_email:S.value,custom_message:I.value});s.value.cor_status=d.status,h.value=!1,v("COR request sent to "+d.institution,"success")}catch(d){v("Failed to send COR: "+(((t=(l=d.response)==null?void 0:l.data)==null?void 0:t.message)||d.message),"emergency")}finally{m.value=!1}}function v(l,t){N.value=l,E.value=t,setTimeout(()=>{N.value=""},5e3)}return(l,t)=>{var d,F,O,B,L,P,T,V,Y,G,H,Q,U,K,J,W,X,Z,ee,te,se,oe,le,ie,ne,ae;return n(),a("div",Se,[j.value?(n(),a("div",Ie,[...t[21]||(t[21]=[e("goa-circular-progress",{size:"large"},null,-1)])])):s.value?(n(),a("div",ze,[e("header",Ee,[e("goa-button",{type:"tertiary",size:"compact",on_click:t[1]||(t[1]=o=>l.$router.push("/staff/queue"))},"Back to Queue",32),e("h1",null,"Review: "+i(s.value.reference_number),1),e("p",null,[u(i(s.value.scholarship_name)+" | Status: ",1),e("span",{class:b(["status-badge",s.value.status.toLowerCase().replace(/\s+/g,"-")])},i(s.value.status),3)])]),N.value?(n(),a("goa-callout",{key:0,type:E.value,heading:N.value},null,8,Fe)):c("",!0),e("div",Oe,[e("div",Be,[e("section",Le,[t[27]||(t[27]=e("h2",null,"Personal Information",-1)),e("div",Pe,[e("div",null,[t[22]||(t[22]=e("strong",null,"Name:",-1)),u(" "+i((d=s.value.personal_info)==null?void 0:d.first_name)+" "+i((F=s.value.personal_info)==null?void 0:F.last_name),1)]),e("div",null,[t[23]||(t[23]=e("strong",null,"Email:",-1)),u(" "+i(s.value.applicant_email),1)]),e("div",null,[t[24]||(t[24]=e("strong",null,"Phone:",-1)),u(" "+i(((O=s.value.personal_info)==null?void 0:O.phone)||"N/A"),1)]),e("div",null,[t[25]||(t[25]=e("strong",null,"DOB:",-1)),u(" "+i((B=s.value.personal_info)!=null&&B.date_of_birth?new Date(s.value.personal_info.date_of_birth).toLocaleDateString("en-CA"):"N/A"),1)]),e("div",Te,[t[26]||(t[26]=e("strong",null,"Address:",-1)),u(" "+i(ge(s.value.personal_info)),1)])])]),e("section",Ve,[t[29]||(t[29]=e("h2",null,"Eligibility Assessment",-1)),e("div",Ye,[e("div",{class:b(["elig-item",(L=s.value.eligibility)!=null&&L.citizenship?"pass":"fail"])},[e("span",Ge,i((P=s.value.eligibility)!=null&&P.citizenship?"✓":"✗"),1),u(" Citizenship: "+i(s.value.citizenship_status||"Not provided"),1)],2),e("div",{class:b(["elig-item",(T=s.value.eligibility)!=null&&T.residency?"pass":"fail"])},[e("span",He,i((V=s.value.eligibility)!=null&&V.residency?"✓":"✗"),1),u(" Alberta Residency: "+i(s.value.residency_status?"Yes":"No"),1)],2),e("div",{class:b(["elig-item",(Y=s.value.eligibility)!=null&&Y.enrollment?"pass":"fail"])},[e("span",Qe,i((G=s.value.eligibility)!=null&&G.enrollment?"✓":"✗"),1),u(" Enrollment: "+i(((H=s.value.postsecondary_info)==null?void 0:H.institution_name)||"Not provided"),1)],2),e("div",{class:b(["elig-item",(Q=s.value.eligibility)!=null&&Q.declaration?"pass":"fail"])},[e("span",Ue,i((U=s.value.eligibility)!=null&&U.declaration?"✓":"✗"),1),t[28]||(t[28]=u(" Declaration Signed ",-1))],2)])]),e("section",Ke,[t[38]||(t[38]=e("h2",null,"Education",-1)),e("div",Je,[e("div",null,[t[30]||(t[30]=e("strong",null,"Institution:",-1)),u(" "+i(((K=s.value.postsecondary_info)==null?void 0:K.institution_name)||"N/A"),1)]),e("div",null,[t[31]||(t[31]=e("strong",null,"Program:",-1)),u(" "+i(((J=s.value.postsecondary_info)==null?void 0:J.program)||"N/A"),1)]),e("div",null,[t[32]||(t[32]=e("strong",null,"Enrollment:",-1)),u(" "+i(((W=s.value.postsecondary_info)==null?void 0:W.enrollment_status)||"N/A"),1)]),e("div",null,[t[33]||(t[33]=e("strong",null,"Year:",-1)),u(" "+i(((X=s.value.postsecondary_info)==null?void 0:X.year_of_study)||"N/A"),1)]),e("div",null,[t[34]||(t[34]=e("strong",null,"Expected Grad:",-1)),u(" "+i(((Z=s.value.postsecondary_info)==null?void 0:Z.expected_graduation)||"N/A"),1)])]),(ee=s.value.high_school_info)!=null&&ee.school_name?(n(),a("div",We,[t[37]||(t[37]=e("h3",null,"High School",-1)),e("div",Xe,[e("div",null,[t[35]||(t[35]=e("strong",null,"School:",-1)),u(" "+i(s.value.high_school_info.school_name),1)]),e("div",null,[t[36]||(t[36]=e("strong",null,"Grad Year:",-1)),u(" "+i(s.value.high_school_info.graduation_year),1)])])])):c("",!0)]),s.value.essay?(n(),a("section",Ze,[t[39]||(t[39]=e("h2",null,"Essay / Personal Statement",-1)),e("div",et,i(s.value.essay),1)])):c("",!0),(te=s.value.additional_info)!=null&&te.extracurriculars||(se=s.value.additional_info)!=null&&se.awards?(n(),a("section",tt,[t[42]||(t[42]=e("h2",null,"Additional Information",-1)),(oe=s.value.additional_info)!=null&&oe.extracurriculars?(n(),a("div",st,[t[40]||(t[40]=e("strong",null,"Extracurriculars:",-1)),e("p",ot,i(s.value.additional_info.extracurriculars),1)])):c("",!0),(le=s.value.additional_info)!=null&&le.awards?(n(),a("div",lt,[t[41]||(t[41]=e("strong",null,"Awards:",-1)),e("p",it,i(s.value.additional_info.awards),1)])):c("",!0)])):c("",!0),e("section",nt,[e("h2",null,"Documents ("+i(((ie=s.value.documents)==null?void 0:ie.length)||0)+")",1),((ne=s.value.documents)==null?void 0:ne.length)>0?(n(),a("div",at,[(n(!0),a(A,null,C(s.value.documents,o=>(n(),a("div",{key:o.id,class:"doc-item"},[e("strong",null,i(o.file_name),1),e("span",ut,i(o.document_type)+" | "+i(_e(o.file_size))+" | "+i(o.verified?"Verified":"Pending"),1)]))),128))])):(n(),a("p",rt,"No documents uploaded."))]),((ae=s.value.history)==null?void 0:ae.length)>0?(n(),a("section",dt,[t[43]||(t[43]=e("h2",null,"Audit History",-1)),e("div",ct,[(n(!0),a(A,null,C(s.value.history,o=>(n(),a("div",{key:o.id,class:"history-item"},[e("strong",null,i(o.action),1),u(" by "+i(o.staff_name||"System")+" ",1),e("span",vt,i(pe(o.created_at)),1)]))),128))])])):c("",!0)]),e("div",gt,[e("div",mt,[t[51]||(t[51]=e("h3",null,"Review Actions",-1)),e("div",pt,[t[45]||(t[45]=e("label",null,"Assigned To",-1)),e("goa-dropdown",{name:"assign",value:s.value.reviewer_id||"",on_change:fe},[t[44]||(t[44]=e("goa-dropdown-item",{value:"",label:"Unassigned"},null,-1)),(n(!0),a(A,null,C(z.value,o=>(n(),a("goa-dropdown-item",{key:o.id,value:o.id,label:o.display_name},null,8,ft))),128))],40,_t)]),e("div",yt,[t[46]||(t[46]=e("label",null,"Add Review Note",-1)),e("goa-textarea",{name:"notes",value:_.value,on_change:t[2]||(t[2]=o=>_.value=o.detail.value),rows:"3",width:"100%"},null,40,ht),e("goa-button",{type:"secondary",size:"compact",on_click:ye,disabled:!_.value.trim()},"Add Note",40,bt)]),s.value.review_notes?(n(),a("div",kt,[t[47]||(t[47]=e("label",null,"Existing Notes",-1)),e("pre",wt,i(s.value.review_notes),1)])):c("",!0),e("div",Rt,[t[48]||(t[48]=e("label",null,"COR Status",-1)),e("div",At,[e("span",{class:b(["cor-badge","cor-"+(s.value.cor_status||"none").toLowerCase().replace(/\s+/g,"-")])},i(s.value.cor_status||"Not Checked"),3)]),!s.value.cor_status||s.value.cor_status==="Pending"?(n(),a("div",Ct,[e("goa-button",{type:"tertiary",size:"compact",on_click:Ae,disabled:m.value},i(m.value?"Checking...":"Check SFS"),41,Nt),e("goa-button",{type:"tertiary",size:"compact",on_click:t[3]||(t[3]=o=>h.value=!0)}," Send COR Request ",32)])):c("",!0),s.value.cor_status==="Requested"?(n(),a("div",xt,[e("goa-button",{type:"tertiary",size:"compact",on_click:t[4]||(t[4]=o=>h.value=!0)}," Resend COR Request ",32)])):c("",!0)]),ve.value?(n(),a("div",Mt,[t[49]||(t[49]=e("h3",null,"Decision",-1)),e("goa-button",{type:"primary",on_click:t[5]||(t[5]=o=>k.value=!0),leadingicon:"checkmark-circle"}," Approve ",32),e("goa-button",{type:"secondary",on_click:t[6]||(t[6]=o=>w.value=!0)}," Reject ",32),e("goa-button",{type:"tertiary",on_click:t[7]||(t[7]=o=>R.value=!0)}," Request Missing Info ",32)])):s.value.decision?(n(),a("div",qt,[t[50]||(t[50]=e("h3",null,"Decision Made",-1)),e("p",null,[e("strong",null,i(s.value.decision),1),u(" on "+i(me(s.value.decision_date)),1)])])):c("",!0)])])]),k.value?(n(),a("div",{key:1,class:"dialog-overlay",onClick:t[10]||(t[10]=x(o=>k.value=!1,["self"]))},[e("div",Dt,[t[52]||(t[52]=e("h3",null,"Approve Application",-1)),e("p",null,"Are you sure you want to approve "+i(s.value.reference_number)+"?",1),e("goa-form-item",St,[e("goa-textarea",{name:"approve-notes",value:M.value,on_change:t[8]||(t[8]=o=>M.value=o.detail.value),rows:"2",width:"100%"},null,40,It)]),e("div",$t,[e("goa-button",{type:"tertiary",on_click:t[9]||(t[9]=o=>k.value=!1)},"Cancel",32),e("goa-button",{type:"primary",on_click:he,disabled:g.value},"Confirm Approve",40,jt)])])])):c("",!0),w.value?(n(),a("div",{key:2,class:"dialog-overlay",onClick:t[13]||(t[13]=x(o=>w.value=!1,["self"]))},[e("div",zt,[t[53]||(t[53]=e("h3",null,"Reject Application",-1)),e("goa-form-item",Et,[e("div",Ft,[(n(),a(A,null,C(de,o=>e("goa-checkbox",{key:o,name:o,text:o,checked:f.value.includes(o),on_change:$=>we(o,$.detail.checked)},null,40,Ot)),64))])]),e("goa-form-item",Bt,[e("goa-textarea",{name:"reject-notes",value:q.value,on_change:t[11]||(t[11]=o=>q.value=o.detail.value),rows:"2",width:"100%"},null,40,Lt)]),e("div",Pt,[e("goa-button",{type:"tertiary",on_click:t[12]||(t[12]=o=>w.value=!1)},"Cancel",32),e("goa-button",{type:"primary",on_click:be,disabled:g.value||f.value.length===0},"Confirm Reject",40,Tt)])])])):c("",!0),R.value?(n(),a("div",{key:3,class:"dialog-overlay",onClick:t[16]||(t[16]=x(o=>R.value=!1,["self"]))},[e("div",Vt,[t[54]||(t[54]=e("h3",null,"Request Missing Information",-1)),e("goa-form-item",Yt,[e("div",Gt,[(n(),a(A,null,C(ce,o=>e("goa-checkbox",{key:o,name:o,text:o,checked:y.value.includes(o),on_change:$=>Re(o,$.detail.checked)},null,40,Ht)),64))])]),e("goa-form-item",Qt,[e("goa-textarea",{name:"mi-message",value:D.value,on_change:t[14]||(t[14]=o=>D.value=o.detail.value),rows:"2",width:"100%"},null,40,Ut)]),e("div",Kt,[e("goa-button",{type:"tertiary",on_click:t[15]||(t[15]=o=>R.value=!1)},"Cancel",32),e("goa-button",{type:"primary",on_click:ke,disabled:g.value||y.value.length===0},"Send MI Request",40,Jt)])])])):c("",!0),h.value?(n(),a("div",{key:4,class:"dialog-overlay",onClick:t[20]||(t[20]=x(o=>h.value=!1,["self"]))},[e("div",Wt,[t[55]||(t[55]=e("h3",null,"Send COR Request",-1)),t[56]||(t[56]=e("p",null,"Send a Confirmation of Registration request to the institution for this application.",-1)),e("goa-form-item",Xt,[e("goa-input",{name:"cor-email",value:S.value,on_change:t[17]||(t[17]=o=>S.value=o.detail.value),width:"100%"},null,40,Zt)]),e("goa-form-item",es,[e("goa-textarea",{name:"cor-msg",value:I.value,on_change:t[18]||(t[18]=o=>I.value=o.detail.value),rows:"2",width:"100%"},null,40,ts)]),e("div",ss,[e("goa-button",{type:"tertiary",on_click:t[19]||(t[19]=o=>h.value=!1)},"Cancel",32),e("goa-button",{type:"primary",on_click:Ce,disabled:m.value},"Send Request",40,os)])])])):c("",!0)])):(n(),a("div",$e,[e("goa-callout",je,[e("goa-button",{type:"tertiary",on_click:t[0]||(t[0]=o=>l.$router.push("/staff/queue"))},"Back to Queue",32)])]))])}}},rs=Ne(ls,[["__scopeId","data-v-2b476df8"]]);export{rs as default};
//# sourceMappingURL=StaffReview-COZ62ZFY.js.map
