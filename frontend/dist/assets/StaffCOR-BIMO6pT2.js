import{_ as I,e as L,o,c as i,a as t,n as g,t as a,d as p,F as A,f as $,m as z,w as U,s as V,v as B,r as u,p as N}from"./index-DDxpmVXJ.js";import{c as w}from"./corService-Dge5eI5Q.js";const E={class:"staff-cor"},j={class:"tabs"},G={key:0,type:"emergency",heading:"Error"},H={key:1,class:"loading"},J={key:2},K={key:0,class:"empty-state"},Q={key:1,class:"data-table"},W=["on_click"],X=["on_click"],Y={key:3},Z={class:"filters"},q=["value"],tt={key:0,class:"empty-state"},et={key:1,class:"data-table"},nt={class:"modal"},st={class:"form-group"},at=["value"],lt={class:"form-group"},ot={class:"modal-actions"},it=["disabled"],ut={key:5,type:"success",heading:"Success"},dt={__name:"StaffCOR",setup(rt){const m=u("pending"),r=u(!0),c=u(null),d=u(null),b=u([]),h=u(0),C=u([]),f=N({status:""}),_=u(!1),S=u(null),y=u(!1),v=N({institution_email:"",custom_message:""});L(()=>R());async function R(){var s,e;r.value=!0,c.value=null;try{const l=await w.getPending();b.value=l.data||[],h.value=l.total||0}catch(l){c.value=((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||l.message||"Failed to load pending COR requests"}finally{r.value=!1}}async function O(){var s,e;r.value=!0,c.value=null;try{const l={};f.status&&(l.status=f.status);const n=await w.getAll(l);C.value=n.data||[]}catch(l){c.value=((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||l.message||"Failed to load COR requests"}finally{r.value=!1}}function T(s){return s>=14?"days-critical":s>=7?"days-warning":"days-normal"}function x(s){return s==="Confirmed"?"status-confirmed":s==="Sent"?"status-sent":s==="Not Confirmed"||s==="Unable to Confirm"?"status-failed":""}function k(s){return s?new Date(s).toLocaleDateString("en-CA"):"-"}function D(s){const e=`${window.location.origin}/cor/respond/${s.response_token||s.id}`;navigator.clipboard.writeText(e).then(()=>{d.value="Response link copied to clipboard",setTimeout(()=>d.value=null,3e3)})}async function F(s){d.value=`Reminder sent to ${s.institution_email||s.institution_name}`,setTimeout(()=>d.value=null,3e3)}async function M(){var s,e;y.value=!0;try{await w.sendRequest(S.value.id,{institution_email:v.institution_email,custom_message:v.custom_message}),_.value=!1,d.value="COR request sent successfully",setTimeout(()=>d.value=null,3e3),R()}catch(l){c.value=((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||l.message||"Failed to send COR request"}finally{y.value=!1}}return(s,e)=>{var l;return o(),i("div",E,[e[16]||(e[16]=t("h1",null,"COR Management",-1)),e[17]||(e[17]=t("p",{class:"subtitle"},"Confirmation of Registration requests and tracking",-1)),t("div",j,[t("button",{class:g({active:m.value==="pending"}),onClick:e[0]||(e[0]=n=>{m.value="pending",R()})}," Pending Responses ("+a(h.value)+") ",3),t("button",{class:g({active:m.value==="all"}),onClick:e[1]||(e[1]=n=>{m.value="all",O()})}," All Requests ",2)]),c.value?(o(),i("goa-callout",G,a(c.value),1)):p("",!0),r.value?(o(),i("div",H,[...e[7]||(e[7]=[t("goa-circular-progress",{size:"large"},null,-1)])])):p("",!0),!r.value&&m.value==="pending"?(o(),i("div",J,[b.value.length===0?(o(),i("div",K,[...e[8]||(e[8]=[t("p",null,"No pending COR requests.",-1)])])):(o(),i("table",Q,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"Reference #"),t("th",null,"Applicant"),t("th",null,"Institution"),t("th",null,"Program"),t("th",null,"Requested"),t("th",null,"Days Pending"),t("th",null,"Actions")])],-1)),t("tbody",null,[(o(!0),i(A,null,$(b.value,n=>(o(),i("tr",{key:n.id,class:g({overdue:n.days_pending>14})},[t("td",null,a(n.reference_number),1),t("td",null,a(n.applicant_name),1),t("td",null,a(n.institution_name),1),t("td",null,a(n.program),1),t("td",null,a(k(n.created_at)),1),t("td",null,[t("span",{class:g(T(n.days_pending))},a(n.days_pending)+" days",3)]),t("td",null,[t("goa-button",{type:"tertiary",size:"compact",on_click:P=>D(n)}," Copy Link ",40,W),t("goa-button",{type:"tertiary",size:"compact",on_click:P=>F(n)}," Remind ",40,X)])],2))),128))])]))])):p("",!0),!r.value&&m.value==="all"?(o(),i("div",Y,[t("div",Z,[t("goa-dropdown",{name:"statusFilter",value:f.status,on_change:e[2]||(e[2]=n=>{f.status=n.detail.value,O()})},[...e[10]||(e[10]=[z('<goa-dropdown-item value="" label="All Statuses" data-v-0494b2c7></goa-dropdown-item><goa-dropdown-item value="Sent" label="Sent" data-v-0494b2c7></goa-dropdown-item><goa-dropdown-item value="Confirmed" label="Confirmed" data-v-0494b2c7></goa-dropdown-item><goa-dropdown-item value="Not Confirmed" label="Not Confirmed" data-v-0494b2c7></goa-dropdown-item><goa-dropdown-item value="Unable to Confirm" label="Unable to Confirm" data-v-0494b2c7></goa-dropdown-item>',5)])],40,q)]),C.value.length===0?(o(),i("div",tt,[...e[11]||(e[11]=[t("p",null,"No COR requests found.",-1)])])):(o(),i("table",et,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"Reference #"),t("th",null,"Applicant"),t("th",null,"Institution"),t("th",null,"Status"),t("th",null,"Requested"),t("th",null,"Responded"),t("th",null,"Turnaround")])],-1)),t("tbody",null,[(o(!0),i(A,null,$(C.value,n=>(o(),i("tr",{key:n.id},[t("td",null,a(n.reference_number),1),t("td",null,a(n.applicant_name),1),t("td",null,a(n.institution_name),1),t("td",null,[t("span",{class:g(["status-badge",x(n.status)])},a(n.status),3)]),t("td",null,a(k(n.created_at)),1),t("td",null,a(n.responded_at?k(n.responded_at):"-"),1),t("td",null,a(n.turnaround_days!=null?n.turnaround_days+" days":"-"),1)]))),128))])]))])):p("",!0),_.value?(o(),i("div",{key:4,class:"modal-overlay",onClick:e[6]||(e[6]=U(n=>_.value=!1,["self"]))},[t("div",nt,[e[15]||(e[15]=t("h2",null,"Send COR Request",-1)),t("p",null,"Send a Confirmation of Registration request to the institution for application "+a((l=S.value)==null?void 0:l.reference_number)+".",1),t("div",st,[t("goa-input",{name:"institution_email",type:"email",value:v.institution_email,on_change:e[3]||(e[3]=n=>v.institution_email=n.detail.value),width:"100%"},[...e[13]||(e[13]=[t("span",{slot:"leadingContent"},"Institution Email",-1)])],40,at)]),t("div",lt,[e[14]||(e[14]=t("label",null,"Custom Message (optional)",-1)),V(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=n=>v.custom_message=n),rows:"3",class:"textarea"},null,512),[[B,v.custom_message]])]),t("div",ot,[t("goa-button",{type:"secondary",on_click:e[5]||(e[5]=n=>_.value=!1)},"Cancel",32),t("goa-button",{type:"primary",on_click:M,disabled:y.value},a(y.value?"Sending...":"Send COR Request"),41,it)])])])):p("",!0),d.value?(o(),i("goa-callout",ut,a(d.value),1)):p("",!0)])}}},vt=I(dt,[["__scopeId","data-v-0494b2c7"]]);export{vt as default};
//# sourceMappingURL=StaffCOR-BIMO6pT2.js.map
